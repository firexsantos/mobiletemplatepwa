/**
 * Framework7 Plugin Keypad 2.0.0
 * Keypad plugin extends Framework7 with additional custom keyboards
 * http://framework7.io/plugins/
 *
 * Copyright 2014-2018 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: February 25, 2018
 */
!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):e.Framework7Keypad=a()}(this,function(){"use strict";var e;return{name:"keypad",install:function(){var a;a=this.Class,e=function(e){function a(t,n){e.call(this,n,[t]);var l=t.utils,s=t.$,r=t.request,p=this;p.app=t;var o,u,i,c=l.extend({on:{}},t.params.keypad);if(p.params=l.extend(c,n),p.params.containerEl&&0===(o=s(p.params.containerEl)).length)return p;if(!p.params.buttons||0===p.params.buttons.length){var d=p.params,v=d.dotCharacter,m=d.dotButton;"numpad"===p.params.type?p.params.buttons=[{html:'<span class="keypad-button-number">1</span><span class="keypad-button-letters"></span>',value:1},{html:'<span class="keypad-button-number">2</span><span class="keypad-button-letters">ABC</span>',value:2},{html:'<span class="keypad-button-number">3</span><span class="keypad-button-letters">DEF</span>',value:3},{html:'<span class="keypad-button-number">4</span><span class="keypad-button-letters">GHI</span>',value:4},{html:'<span class="keypad-button-number">5</span><span class="keypad-button-letters">JKL</span>',value:5},{html:'<span class="keypad-button-number">6</span><span class="keypad-button-letters">MNO</span>',value:6},{html:'<span class="keypad-button-number">7</span><span class="keypad-button-letters">PQRS</span>',value:7},{html:'<span class="keypad-button-number">8</span><span class="keypad-button-letters">TUV</span>',value:8},{html:'<span class="keypad-button-number">9</span><span class="keypad-button-letters">WXYZ</span>',value:9},{html:m?'<span class="keypad-button-number">'+v+"</span>":"",value:m?v:void 0,dark:!0,cssClass:m?"":"keypad-dummy-button"},{html:'<span class="keypad-button-number">0</span>',value:0},{html:'<i class="icon icon-keypad-delete"></i>',cssClass:"keypad-delete-button",dark:!0}]:"calculator"===n.type&&(p.params.buttons=[{html:'<span class="keypad-button-number">C</span>',value:"C",dark:!0},{html:'<span class="keypad-button-number">±</span>',value:"±",dark:!0},{html:'<span class="keypad-button-number">%</span>',value:"%",dark:!0},{html:'<span class="keypad-button-number">÷</span>',value:"÷",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">7</span>',value:7},{html:'<span class="keypad-button-number">8</span>',value:8},{html:'<span class="keypad-button-number">9</span>',value:9},{html:'<span class="keypad-button-number">×</span>',value:"×",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">4</span>',value:4},{html:'<span class="keypad-button-number">5</span>',value:5},{html:'<span class="keypad-button-number">6</span>',value:6},{html:'<span class="keypad-button-number">-</span>',value:"-",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">1</span>',value:1},{html:'<span class="keypad-button-number">2</span>',value:2},{html:'<span class="keypad-button-number">3</span>',value:3},{html:'<span class="keypad-button-number">+</span>',value:"+",cssClass:"calc-operator-button"},{html:'<span class="keypad-button-number">0</span>',value:0,cssClass:"keypad-button-double"},{html:'<span class="keypad-button-number">.</span>',value:v},{html:'<span class="keypad-button-number">=</span>',value:"=",cssClass:"calc-operator-button calc-operator-button-equal"}])}function y(){p.open()}function h(e){e.preventDefault()}function f(e){var a=s(e.target);p.isPopover()||p.opened&&(a.closest('[class*="backdrop"]').length||(u&&u.length>0?a[0]!==u[0]&&0===a.closest(".sheet-modal, .keypad-modal").length&&p.close():0===s(e.target).closest(".sheet-modal, .keypad-modal").length&&p.close()))}return p.params.inputEl&&(u=s(p.params.inputEl)),(i=p.params.view?p.params.view:u&&u.length?u.parents(".view").length&&u.parents(".view")[0].f7View:t.views.get(u))||(i=t.views.main),l.extend(p,{app:t,request:r,$containerEl:o,containerEl:o&&o[0],inline:o&&o.length>0,$inputEl:u,inputEl:u&&u[0],initialized:!1,opened:!1,view:i,url:p.params.url,calcValues:[],calcOperations:[],lastWasNumber:!1}),l.extend(p,{attachInputEvents:function(){p.$inputEl.on("click",y),p.params.inputReadOnly&&p.$inputEl.on("focus mousedown",h)},detachInputEvents:function(){p.$inputEl.off("click",y),p.params.inputReadOnly&&p.$inputEl.off("focus mousedown",h)},attachHtmlEvents:function(){t.on("click",f)},detachHtmlEvents:function(){t.off("click",f)}}),p.attachKeypadEvents=function(){var e=p.$el.find(".keypad-buttons");function a(a){var t=s(a.target);if(t.hasClass("keypad-button")||(t=t.parents(".keypad-button")),0!==t.length){var n=p.params.buttons[t.index()],l=n.value,r=p.value;"numpad"===p.params.type&&(void 0===r&&(r=""),t.hasClass("keypad-delete-button")?r=r.substring(0,r.length-1):void 0!==l&&("."===l&&r.indexOf(".")>=0&&(l=""),r+=l),void 0!==r&&p.setValue(r)),"calculator"===p.params.type&&(p.calculator(n.value),e.find(".calc-operator-active").removeClass("calc-operator-active"),t.hasClass("calc-operator-button")&&!t.hasClass("calc-operator-button-equal")&&t.addClass("calc-operator-active")),p.emit("local::buttonClick keypadButtonClick",p,n),n.onClick&&n.onClick(p,n)}}e.on("click",a),p.detachKeypadEvents=function(){e.off("click",a)}},u&&u.length&&(u[0].f7Keypad=a),o&&o.length&&(o[0].f7Keypad=a),p.init(),p}return e&&(a.__proto__=e),(a.prototype=Object.create(e&&e.prototype)).constructor=a,a.prototype.initInput=function(){var e=this;e.$inputEl&&e.params.inputReadOnly&&e.$inputEl.prop("readOnly",!0)},a.prototype.isPopover=function(){var e=this,a=e.app,t=e.modal,n=e.params;if("sheet"===n.openIn)return!1;if(t&&"popover"!==t.type)return!1;if(!e.inline&&e.inputEl){if("popover"===n.openIn)return!0;if(a.device.ios)return!!a.device.ipad;if(a.width>=768)return!0}return!1},a.prototype.calculator=function(e){var a=this,t="+ - = × ÷ ± %".split(" ");function n(){for(var e="",n=0;n<a.calcOperations.length;n+=1){var l=a.calcOperations[n];n===a.calcOperations.length-1&&t.indexOf(l)>=0||l&&("."===l&&(l=0),e+=(""+l.toString()).replace("×","*").replace("÷","/"))}e=e.replace(/--/g,"+"),a.setValue(eval.call(window,e))}if(a.value||(a.value=0),"C"===e)return a.setValue(0),a.calcValues=[],void(a.calcOperations=[]);if([0,1,2,3,4,5,6,7,8,9,"."].indexOf(e)>=0){if("."===e&&a.lastWasNumber&&a.value.toString().indexOf(".")>=0)return;t.indexOf(a.calcValues[a.calcValues.length-1])>=0?a.setValue(e):a.setValue(a.value?""+a.value+e:e),a.lastWasNumber=!0}if(t.indexOf(e)>=0)if("±"===e){if("."===a.value)return;a.setValue(-1*a.value),a.lastWasNumber=!0}else if("%"===e){if(a.calcOperations[a.calcOperations.length-2]){var l=a.value/100;a.setValue(a.calcOperations[a.calcOperations.length-2]*l)}a.lastWasNumber=!0}else{var s=a.calcOperations[a.calcOperations.length-1];if("="===e){if("="===a.calcOperations[a.calcOperations.length-1]){if(a.calcOperations.length<2)return;a.calcOperations.pop();var r=a.calcOperations[a.calcOperations.length-2],p=a.calcOperations[a.calcOperations.length-1];a.calcOperations.push(r),a.calcOperations.push(p)}else a.calcOperations.push(a.value);a.calcOperations.push("="),n()}else["-","+","×","÷","="].indexOf(s)>=0?("="===s&&(a.calcOperations=[a.value,e]),["-","+","×","÷"].indexOf(s)>=0&&(a.lastWasNumber?["-","+"].indexOf(s)>=0&&["×","÷"].indexOf(e)>=0?(a.calcOperations.push(a.value),a.calcOperations.push(e)):(a.calcOperations.push(a.value),a.calcOperations.push(e),n()):a.calcOperations[a.calcOperations.length-1]=e)):(a.calcOperations.push(a.value),a.calcOperations.push(e),n());a.lastWasNumber=!1}"±"!==e&&"%"!==e&&a.calcValues.push(e)},a.prototype.formatValue=function(e){return this.params.formatValue?this.params.formatValue.call(this,e):e},a.prototype.setValue=function(e){this.updateValue(e)},a.prototype.getValue=function(){return this.value},a.prototype.updateValue=function(e){var a=this;a.value=e,a.params.valueMaxLength&&a.value.length>a.params.valueMaxLength&&(a.value=a.value.substring(0,a.params.valueMaxLength)),a.emit("local::change keypadChange",a,a.value),a.$inputEl&&a.$inputEl.length>0&&(a.$inputEl.val(a.formatValue(a.value)),a.$inputEl.trigger("change"))},a.prototype.renderButtons=function(){for(var e,a,t="",n=0;n<this.params.buttons.length;n+=1)e="keypad-button",(a=this.params.buttons[n]).dark&&(e+=" keypad-button-dark"),a.cssClass&&(e+=" "+a.cssClass),t+='<span class="'+e+'">'+(a.html||"")+"</span>";return t},a.prototype.renderToolbar=function(){var e=this;return e.params.renderToolbar?e.params.renderToolbar.call(e,e):('\n        <div class="toolbar">\n          <div class="toolbar-inner">\n            <div class="left"></div>\n            <div class="right">\n              <a href="#" class="link sheet-close popover-close">'+e.params.toolbarCloseText+"</a>\n            </div>\n          </div>\n        </div>\n      ").trim()},a.prototype.renderSheet=function(){var e=this;if(e.params.renderSheet)return e.params.renderSheet.call(e,e);var a=e.params,t=a.cssClass,n=a.toolbar;return'\n        <div class="sheet-modal keypad keypad-sheet keypad-type-'+e.params.type+" "+(t||"")+'">\n          '+(n?e.renderToolbar():"")+'\n          <div class="sheet-modal-inner keypad-buttons">\n            '+e.renderButtons()+"\n          </div>\n        </div>\n      "},a.prototype.renderPopover=function(){var e=this;if(e.params.renderPopover)return e.params.renderPopover.call(e,e);var a=e.params,t=a.cssClass,n=a.toolbar;return('\n        <div class="popover keypad-popover">\n          <div class="popover-inner">\n            <div class="keypad keypad-type-'+e.params.type+" "+(t||"")+'">\n              '+(n?e.renderToolbar():"")+'\n              <div class="keypad-buttons">\n                '+e.renderButtons()+"\n              </div>\n            </div>\n          </div>\n        </div>\n      ").trim()},a.prototype.renderInline=function(){var e=this;if(e.params.renderInline)return e.params.renderInline.call(e,e);var a=e.params,t=a.cssClass,n=a.toolbar;return'\n        <div class="keypad keypad-inline keypad-type-'+e.params.type+" "+(t||"")+'">\n          '+(n?e.renderToolbar():"")+'\n          <div class="keypad-buttons">\n            '+e.renderButtons()+"\n          </div>\n        </div>\n      "},a.prototype.render=function(){var e=this,a=e.params;if(a.render)return a.render.call(e);if(!e.inline){var t=a.openIn;if("auto"===t&&(t=e.isPopover()?"popover":"sheet"),"popover"===t)return e.renderPopover();if("sheet"===t)return e.renderSheet()}return e.renderInline()},a.prototype.onOpen=function(){var e=this,a=e.initialized,t=e.$el,n=e.app,l=e.$inputEl,s=e.inline,r=e.value,p=e.params;e.opened=!0,e.attachKeypadEvents(),a?r&&e.setValue(r):r?e.setValue(r):p.value&&e.setValue(p.value),!s&&l.length&&"md"===n.theme&&l.trigger("focus"),e.initialized=!0,t&&t.trigger("keypad:open",e),l&&l.trigger("keypad:open",e),e.emit("local::open keypadOpen",e)},a.prototype.onOpened=function(){var e=this;e.$el&&e.$el.trigger("keypad:opened",e),e.$inputEl&&e.$inputEl.trigger("keypad:opened",e),e.emit("local::opened keypadOpened",e)},a.prototype.onClose=function(){var e=this,a=e.app;e.$inputEl&&"md"===a.theme&&e.$inputEl.trigger("blur"),e.detachKeypadEvents&&e.detachKeypadEvents(),e.$el&&e.$el.trigger("keypad:close",e),e.$inputEl&&e.$inputEl.trigger("keypad:close",e),e.emit("local::close keypadClose",e)},a.prototype.onClosed=function(){var e=this;e.opened=!1,e.inline||e.app.utils.nextTick(function(){e.modal&&e.modal.el&&e.modal.destroy&&(e.params.routableModals||e.modal.destroy()),delete e.modal}),e.$el&&e.$el.trigger("keypad:closed",e),e.$inputEl&&e.$inputEl.trigger("keypad:closed",e),e.emit("local::closed keypadClosed",e)},a.prototype.open=function(){var e,a=this,t=a.app,n=a.opened,l=a.inline,s=a.$inputEl,r=a.params;if(!n){if(l)return a.$el=t.$(a.render()),a.$el[0].f7Keypad=a,a.$containerEl.append(a.$el),a.onOpen(),void a.onOpened();var p=r.openIn;"auto"===p&&(p=a.isPopover()?"popover":"sheet");var o=a.render(),u={targetEl:s,scrollToEl:a.params.scrollToInput?s:void 0,content:o,backdrop:"sheet"!==p,on:{open:function(){a.modal=this,a.$el="popover"===p?this.$el.find(".keypad"):this.$el,a.$el[0].f7Keypad=a,a.onOpen()},opened:function(){a.onOpened()},close:function(){a.onClose()},closed:function(){a.onClosed()}}};a.params.routableModals?a.view.router.navigate({url:a.url,route:(e={path:a.url},e[p]=u,e)}):(a.modal=t[p].create(u),a.modal.open())}},a.prototype.close=function(){var e=this,a=e.opened,t=e.inline;if(a)return t?(e.onClose(),void e.onClosed()):void(e.params.routableModals?e.view.router.back():e.modal.close())},a.prototype.init=function(){var e=this;if(e.initInput(),e.inline)return e.open(),void e.emit("local::init keypadInit",e);!e.initialized&&e.params.value&&e.setValue(e.params.value),e.$inputEl&&e.attachInputEvents(),e.params.closeByOutsideClick&&e.attachHtmlEvents(),e.emit("local::init keypadInit",e)},a.prototype.destroy=function(){var e=this;if(!e.destroyed){var a=e.$el;e.emit("local::beforeDestroy keypadBeforeDestroy",e),a&&a.trigger("keypad:beforedestroy",e),e.close(),e.$inputEl&&e.detachInputEvents(),e.params.closeByOutsideClick&&e.detachHtmlEvents(),a&&a.length&&delete e.$el[0].f7Keypad,e.app.utils.deleteProps(e),e.destroyed=!0}},a}(a),this.Keypad=e},params:{keypad:{type:"numpad",openIn:"auto",inputEl:null,containerEl:null,value:null,valueMaxLength:null,dotButton:!0,dotCharacter:".",buttons:[],closeByOutsideClick:!0,scrollToInput:!0,inputReadOnly:!0,onlyInPopover:!1,cssClass:null,toolbar:!0,toolbarCloseText:"Done",routableModals:!0,view:null,url:"select/",renderToolbar:null,renderPopover:null,renderSheet:null,renderInline:null,render:null}},create:function(){var a=this,t=a.$;a.keypad={create:function(t){return new e(a,t)},get:function(a){if(void 0===a&&(a=".keypad"),a instanceof e)return a;var n=t(a);return 0!==n.length?n[0].f7Keypad:void 0},destroy:function(e){void 0===e&&(e=".keypad");var t=a.keypad.get(e);if(t&&t.destroy)return t.destroy()},close:function(e){void 0===e&&(e=".keypad");var a=t(e);if(0!==a.length){var n=a[0].f7Keypad;!n||n&&!n.opened||n.close()}}}},on:{pageInit:function(e){var a=e.app.$,t=e.app;e.$el.find('input[type="numpad"], input[type="calculator"]').each(function(e,n){var l=a(n),s={inputEl:n,type:l.attr("type"),value:l.val()||0};l.attr("maxlength")&&(s.valueMaxLength=l.attr("maxlength")),t.keypad.create(t.utils.extend(s,l.dataset()))})},pageBeforeRemove:function(e){e.$el.find('input[type="numpad"], input[type="calculator"]').each(function(a,t){e.app.keypad.destroy(t)})}}}});
//# sourceMappingURL=framework7.keypad.min.js.map
